<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>javascript 执行机制总结 | HMC NOTE</title>
    <meta name="description" content="record hmc note">
    
    
    <link rel="preload" href="/HMC-VUEPRESS-NOTE/assets/css/0.styles.5436bfc8.css" as="style"><link rel="preload" href="/HMC-VUEPRESS-NOTE/assets/js/app.b95e11c9.js" as="script"><link rel="preload" href="/HMC-VUEPRESS-NOTE/assets/js/2.2ebf18b2.js" as="script"><link rel="preload" href="/HMC-VUEPRESS-NOTE/assets/js/36.3e16e88b.js" as="script"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/10.21d33aea.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/11.e95ca2a9.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/12.47d8c248.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/13.c0b19213.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/14.a5cca3fa.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/15.e31eeca3.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/16.00c4ff58.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/17.290af45a.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/18.cd6c026e.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/19.f76e3460.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/20.ecc5146c.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/21.c055c669.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/22.92375dfb.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/23.cfe2e1f7.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/24.687b3795.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/25.a76c3120.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/26.ef25e024.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/27.d19aa571.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/28.624e4d80.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/29.c938c1d9.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/3.e9354191.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/30.97e9b5e5.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/31.166af530.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/32.55d73ff0.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/33.4fa7228f.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/34.7f64a477.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/35.b920fb64.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/37.c668da86.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/38.78b74b3f.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/39.883ab6e6.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/4.a18312b1.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/40.6cafcae9.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/41.af06a2b4.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/42.f8ce12e2.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/5.d87c91cd.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/6.eb1c9758.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/7.37f99056.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/8.e9086008.js"><link rel="prefetch" href="/HMC-VUEPRESS-NOTE/assets/js/9.aba3112f.js">
    <link rel="stylesheet" href="/HMC-VUEPRESS-NOTE/assets/css/0.styles.5436bfc8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/HMC-VUEPRESS-NOTE/" class="home-link router-link-active"><!----> <span class="site-name">HMC NOTE</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/HMC-VUEPRESS-NOTE/" class="nav-link">首页</a></div><div class="nav-item"><a href="/HMC-VUEPRESS-NOTE/javascript进阶/" class="nav-link">javascript进阶</a></div><div class="nav-item"><a href="/HMC-VUEPRESS-NOTE/css进阶/" class="nav-link">css进阶</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/HMC-VUEPRESS-NOTE/" class="nav-link">首页</a></div><div class="nav-item"><a href="/HMC-VUEPRESS-NOTE/javascript进阶/" class="nav-link">javascript进阶</a></div><div class="nav-item"><a href="/HMC-VUEPRESS-NOTE/css进阶/" class="nav-link">css进阶</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>第一章：DOM</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>第二章：JS常用代码原理实现</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>第三章：JS深入</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/HMC-VUEPRESS-NOTE/javascript进阶/javascript深入/原型和原型链.html" class="sidebar-link">1.原型和原型链</a></li><li><a href="/HMC-VUEPRESS-NOTE/javascript进阶/javascript深入/JS事件循环执行机制.html" class="sidebar-link">2.JS事件循环执行机制</a></li><li><a href="/HMC-VUEPRESS-NOTE/javascript进阶/javascript深入/JS执行机制深入总结.html" class="active sidebar-link">3.JS执行机制深入总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/HMC-VUEPRESS-NOTE/javascript进阶/javascript深入/JS执行机制深入总结.html#词法作用域" class="sidebar-link">词法作用域</a></li><li class="sidebar-sub-header"><a href="/HMC-VUEPRESS-NOTE/javascript进阶/javascript深入/JS执行机制深入总结.html#执行上下文栈" class="sidebar-link">执行上下文栈</a></li><li class="sidebar-sub-header"><a href="/HMC-VUEPRESS-NOTE/javascript进阶/javascript深入/JS执行机制深入总结.html#变量对象" class="sidebar-link">变量对象</a></li><li class="sidebar-sub-header"><a href="/HMC-VUEPRESS-NOTE/javascript进阶/javascript深入/JS执行机制深入总结.html#执行过程" class="sidebar-link">执行过程</a></li><li class="sidebar-sub-header"><a href="/HMC-VUEPRESS-NOTE/javascript进阶/javascript深入/JS执行机制深入总结.html#作用域链" class="sidebar-link">作用域链</a></li><li class="sidebar-sub-header"><a href="/HMC-VUEPRESS-NOTE/javascript进阶/javascript深入/JS执行机制深入总结.html#this指向" class="sidebar-link">this指向</a></li><li class="sidebar-sub-header"><a href="/HMC-VUEPRESS-NOTE/javascript进阶/javascript深入/JS执行机制深入总结.html#执行上下文过程总结" class="sidebar-link">执行上下文过程总结</a></li><li class="sidebar-sub-header"><a href="/HMC-VUEPRESS-NOTE/javascript进阶/javascript深入/JS执行机制深入总结.html#参考文献" class="sidebar-link">参考文献</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>第四章：JS设计模式</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="javascript-执行机制总结"><a href="#javascript-执行机制总结" aria-hidden="true" class="header-anchor">#</a> javascript 执行机制总结</h1> <h2 id="词法作用域"><a href="#词法作用域" aria-hidden="true" class="header-anchor">#</a> 词法作用域</h2> <p>JavaScript 采用的是词法作用域，函数的作用域在函数定义的时候就决定了。</p> <p>而函数调用对于变量时的查找是通过作用域链进行的，因此在函数创建的时候其实已经添加了作用域链</p> <h2 id="执行上下文栈"><a href="#执行上下文栈" aria-hidden="true" class="header-anchor">#</a> 执行上下文栈</h2> <p>可执行代码：全局代码、函数代码、eval代码
当调用可执行代码的时候，即会创建可执行上下文，JavaScript 引擎创建了执行上下文栈（Execution context stack，ECS）来管理执行上下文</p> <p>js初始化的时候即会压入全局可执行上下文（global context）,程序执行完成之前底部必有一个global context</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>ECStack <span class="token operator">=</span> <span class="token punctuation">{</span>
    globalContext
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>每个<strong>执行上下文</strong>，都包含三个对象</p> <ul><li>变量对象(Variable object，VO)</li> <li>作用域链(Scope chain)</li> <li>this</li></ul> <p>全局上下文的变量对象就是全局对象，在浏览器系统中就是window.</p> <h2 id="变量对象"><a href="#变量对象" aria-hidden="true" class="header-anchor">#</a> 变量对象</h2> <h3 id="函数上下文"><a href="#函数上下文" aria-hidden="true" class="header-anchor">#</a> 函数上下文</h3> <p>在函数上下文中，我们用活动对象(activation object, AO)来表示变量对象</p> <img src="/HMC-VUEPRESS-NOTE/img/AO对象创建过程.png"> <p>活动对象是在进入函数上下文时刻被创建的，它通过函数的 arguments 属性初始化。arguments 属性值是 Arguments 对象。然后再按上图步骤声明其他变量</p> <h2 id="执行过程"><a href="#执行过程" aria-hidden="true" class="header-anchor">#</a> 执行过程</h2> <h3 id="进入执行上下文"><a href="#进入执行上下文" aria-hidden="true" class="header-anchor">#</a> 进入执行上下文</h3> <p>当进入执行上下文时，这时候还没有执行代码，此刻创建活动对象</p> <p>变量对象会包括：</p> <ol><li>函数的所有形参 (如果是函数上下文)
<ul><li>由名称和对应值组成的一个变量对象的属性被创建</li> <li>没有实参，属性值设为 undefined</li></ul></li> <li>函数声明
<ul><li>由名称和对应值（函数对象(function-object)）组成一个变量对象的属性被创建</li> <li>如果变量对象已经存在相同名称的属性，则完全替换这个属性</li></ul></li> <li>变量声明
<ul><li>由名称和对应值（undefined）组成一个变量对象的属性被创建；</li> <li>如果变量名称跟已经声明的形式参数或函数相同，则变量声明不会干扰已经存在的这类属性</li></ul></li></ol> <h3 id="代码执行"><a href="#代码执行" aria-hidden="true" class="header-anchor">#</a> 代码执行</h3> <p>在代码执行阶段，会顺序执行代码，根据代码，修改变量对象的值</p> <p>举个例子：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">var</span> <span class="token function-variable function">d</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  b <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>在进入执行上下文后，这时候的 AO 是：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">AO</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    arguments<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token number">0</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        length<span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    a<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    b<span class="token punctuation">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
    c<span class="token punctuation">:</span> reference to <span class="token keyword">function</span> <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    d<span class="token punctuation">:</span> <span class="token keyword">undefined</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>在代码执行阶段，会顺序执行代码，根据代码，修改变量对象的值</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">AO</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    arguments<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token number">0</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        length<span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    a<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    b<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    c<span class="token punctuation">:</span> reference to <span class="token keyword">function</span> <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    d<span class="token punctuation">:</span> reference to FunctionExpression <span class="token string">&quot;d&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h3> <ol><li><p>全局上下文的变量对象初始化是全局对象</p></li> <li><p>进入函数上下文的变量对象初始化只包括 Arguments 对象</p></li> <li><p>在进入执行上下文时会给变量对象添加形参、函数声明、变量声明等初始的属性值</p></li> <li><p>在代码执行阶段，会再次修改变量对象的属性值</p></li></ol> <h2 id="作用域链"><a href="#作用域链" aria-hidden="true" class="header-anchor">#</a> 作用域链</h2> <p>每个<strong>执行上下文</strong>，都包含三个对象</p> <ul><li>变量对象(Variable object，VO)</li> <li>作用域链(Scope chain)</li> <li>this</li></ul> <p>由JavaScript词法作用域，函数的作用域在函数定义的时候就已经决定了<br>
这是因为函数有一个内部属性 [[scope]]，当函数创建的时候，就会保存所有父变量对象到其中，你可以理解 [[scope]] 就是所有父变量对象的层级链</p> <h3 id="函数激活"><a href="#函数激活" aria-hidden="true" class="header-anchor">#</a> 函数激活</h3> <p>当函数激活时，进入函数上下文，创建 VO/AO 后，就会将活动对象添加到作用链的前端，此时作用域链创建完毕</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>Scope <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token constant">AO</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>Scope<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="函数的参数"><a href="#函数的参数" aria-hidden="true" class="header-anchor">#</a> 函数的参数</h3> <p>函数的参数在内部是用数组的方式存储的，因此JS的函数不介意传递过来多少个参数，在函数体内可用通过aruguments对象来访问这个参数数组，在上下文创建活动对象AO的时候创建。arguments的长度等于实际参数的长度</p> <h3 id="函数的操作"><a href="#函数的操作" aria-hidden="true" class="header-anchor">#</a> 函数的操作</h3> <blockquote><p>创建函数<br>
1,先开辟一个新的内存空间<br>
2,把函数体中编写的js代码当作字符串存储到空间中，函数只创建不执行没有意义，因为其中都是字符串
3,把分配的地址赋值给声明的函数名（function fn 和 var fn操作原理相同，都是在当前作用域中声明了一个名字，var fn只是变量的声明，在执行的时候才将函数体赋值给fn,而function fn是函数的声明和创建，声明的时候就已经赋值）</p></blockquote> <blockquote><p>执行函数<br>
1,函数执行的时候会形成一个新的私有作用域，只能执行函数体中的代码<br>
2,执行代码之前，先把创建函数存储的字符串变成真正的js表达式，按照从上到下的顺序在私有作用域执行<br>
3,一个函数可以执行n次，互不干扰，形成的私有作用域把函数体中的私有变量都包裹起来了，这种保护机制是闭包的保护功能</p></blockquote> <h3 id="js中的栈内存和堆内存"><a href="#js中的栈内存和堆内存" aria-hidden="true" class="header-anchor">#</a> JS中的栈内存和堆内存</h3> <p><strong>栈内存</strong>：
俗称作用域（全局私有）,执行上下文即是栈内存。为js代码提供执行的环境，基本数据类型的直是直接存放在栈内存之中的<br> <strong>堆内存</strong>：
存储引用数据类型（相当于一个存储的仓库），对象存储的是键值对，函数存储的是代码字符串<br>
【堆内存】<br>
var o = {},当前对象堆内存被变量o占用则堆内存是无法销毁的
o = null，null为空对象指针，此时上一次的堆内存就没有被占用了，chrome浏览器会在空闲时间把没有被占用的堆内存自动释放<br>
【栈内存】
一般情况下，函数执行形成栈内存，函数执行完，浏览器会把形成的栈内存自动释放；但有时候执行完成，栈内存不能被释放。全局作用域在加载页面但时候执行，在关掉页面但时候销毁</p> <h3 id="函数执行上下文中作用域链和变量对象的创建过程"><a href="#函数执行上下文中作用域链和变量对象的创建过程" aria-hidden="true" class="header-anchor">#</a> 函数执行上下文中作用域链和变量对象的创建过程</h3> <ol><li>函数创建的时候，保存作用域链到内部属性[[scope]]</li> <li>执行函数的时候，先创建函数执行上下文，函数执行上下文被压入执行上下文栈</li> <li>函数并不立刻执行，开始做准备工作，即变量对象的创建和作用域链的创建</li> <li>第一步：复制函数[[scope]]属性创建作用域链</li> <li>第二步：用 arguments 创建活动对象，随后初始化活动对象，加入形参、函数声明、变量声明（变量提升）</li> <li>第三步：将活动对象压入作用域链顶端</li> <li>准备工作做完，开始执行函数，随着函数的执行，修改 AO 的属性值</li> <li>函数返回后函数执行完毕，函数上下文从执行上下文栈中弹出</li></ol> <p>例子等均可参考引用文献</p> <h2 id="this指向"><a href="#this指向" aria-hidden="true" class="header-anchor">#</a> this指向</h2> <p>每个<strong>执行上下文</strong>，都包含三个对象</p> <ul><li>变量对象(Variable object，VO)</li> <li>作用域链(Scope chain)</li> <li>this</li></ul> <p>牢记两点：</p> <ol><li>普通函数的this的指向只与调用时的执行上下文有关</li> <li>箭头函数由词法作用域，无this,指向当前执行上下文的this即可。</li></ol> <h3 id="普通函数"><a href="#普通函数" aria-hidden="true" class="header-anchor">#</a> 普通函数</h3> <ol><li>对象调用：Obj.a(), this指向Obj</li> <li>函数调用：a(), this指向window, 严格模式是undefined</li> <li>构造函数：new a(), this指向当前对象</li> <li>重定向调用： Obj.a.bind(b), this指向b</li> <li>普通函数的this在回调中指向window, 原因是同无对象调用，单纯函数调用。</li> <li>因此自执行函数无对象调用，this-&gt;window，任何时候</li> <li>回调函数为匿名函数时，执行上下文-&gt;回调函数的this会指向window</li></ol> <h3 id="箭头函数"><a href="#箭头函数" aria-hidden="true" class="header-anchor">#</a> 箭头函数</h3> <ol><li>在方法中定义时，由于方法是对象调用的，因此词法，this-&gt;调用的对象</li> <li>箭头函数当作对象的方法定义时，创建对象实则时先创建函数-&gt;赋值给变量，因此指向window.即此时的词法上下文是window,因为变量创建的时候是没有生成执行上下文的，此时的执行上下文依然是全局执行上下文</li> <li>回调函数中定义时，词法，this-&gt;调用的对象，如setTimeOut,Promise.</li></ol> <h2 id="执行上下文过程总结"><a href="#执行上下文过程总结" aria-hidden="true" class="header-anchor">#</a> 执行上下文过程总结</h2> <p>(摘自冴羽大大深入理解之执行上下文)</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> scope <span class="token operator">=</span> <span class="token string">&quot;global scope&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">checkscope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> scope <span class="token operator">=</span> <span class="token string">&quot;local scope&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> scope<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> f<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token function">checkscope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>1.代码执行，进入全局执行上下文，压入执行上下文栈</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>ECStack <span class="token operator">=</span> <span class="token punctuation">[</span>
    globalContext
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>2.全局上下文初始化</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>globalContext <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token constant">VO</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>global<span class="token punctuation">]</span><span class="token punctuation">,</span>
        Scope<span class="token punctuation">:</span> <span class="token punctuation">[</span>globalContext<span class="token punctuation">.</span><span class="token constant">VO</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">:</span> globalContext<span class="token punctuation">.</span><span class="token constant">VO</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>3.函数checkscope创建，保存作用域链到内部属性[[scope]]表示</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>checkscope<span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token punctuation">[</span>scope<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
      globalContext<span class="token punctuation">.</span><span class="token constant">VO</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>4.checkscope执行，创建执行上下文，并压入执行上下文栈</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>ECStack <span class="token operator">=</span> <span class="token punctuation">[</span>
    checkscopeContext<span class="token punctuation">,</span>
    globalContext
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>5.checkscopeContext上下文初始化</p> <ol><li>复制函数 [[scope]] 属性创建作用域链，</li> <li>用 arguments 创建活动对象AO，</li> <li>初始化活动对象，即加入形参、函数声明、变量声明，</li> <li>将活动对象压入 checkscope 作用域链顶端。</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>checkscopeContext <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token constant">AO</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            arguments<span class="token punctuation">:</span><span class="token punctuation">{</span>
                length<span class="token punctuation">:</span><span class="token number">0</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            scope<span class="token punctuation">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
            f<span class="token punctuation">:</span> reference to <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        Scope<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token constant">AO</span><span class="token punctuation">,</span>globalContext<span class="token punctuation">.</span><span class="token constant">VO</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">:</span> <span class="token keyword">undefined</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>6.checkscope函数执行，返回f函数，checkscopeContext退栈</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>ECStack <span class="token operator">=</span> <span class="token punctuation">[</span>
    globalContext
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>7.将f函数赋值给foo,foo执行。需要注意的是此时checkscope已经退栈，那么foo执行的时候为何scope依然引用的是“local scope”呢，原因是执行机制中，f函数创建的时候已经保存了作用域链,f的执行上下文退栈，但是其AO并没有销毁，这就是闭包的原理</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>f<span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token punctuation">[</span>scope<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    checkscope<span class="token punctuation">.</span><span class="token constant">AO</span><span class="token punctuation">,</span>
    globalContext<span class="token punctuation">.</span><span class="token constant">VO</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>8.foo执行，创建执行上下文，压入执行上下文栈，初始化步骤同上，然后执行</p> <ol><li>复制函数 [[scope]] 属性创建作用域链，</li> <li>用 arguments 创建活动对象AO，</li> <li>初始化活动对象，即加入形参、函数声明、变量声明，</li> <li>将活动对象压入 checkscope 作用域链顶端。</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>fooContext <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token constant">AO</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            arguments<span class="token punctuation">:</span><span class="token punctuation">{</span>
                length<span class="token punctuation">:</span><span class="token number">0</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>   
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        Scope<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token constant">AO</span><span class="token punctuation">,</span>checkscope<span class="token punctuation">.</span><span class="token constant">AO</span><span class="token punctuation">,</span>globalContext<span class="token punctuation">.</span><span class="token constant">VO</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">:</span> <span class="token keyword">undefined</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="参考文献"><a href="#参考文献" aria-hidden="true" class="header-anchor">#</a> 参考文献</h2> <ol><li><a href="https://github.com/mqyqingfeng/Blog/issues/3" target="_blank" rel="noopener noreferrer">冴羽大大深入理解系列<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.cnblogs.com/TomXu/archive/2012/01/16/2309728.html" target="_blank" rel="noopener noreferrer">汤姆大叔深入js系列<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.cnblogs.com/ivehd/p/vo_ao.html" target="_blank" rel="noopener noreferrer">图解Javascript——变量对象和活动对象<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.cnblogs.com/dongcanliang/p/7054176.html" target="_blank" rel="noopener noreferrer">this指向详细解析(箭头函数)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.cnblogs.com/gavinyyb/articles/6286750.html" target="_blank" rel="noopener noreferrer">理解JS回调函数<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://juejin.im/entry/57fee360a22b9d005b1d9ae3" target="_blank" rel="noopener noreferrer">JS的匿名函数与自执行<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.cnblogs.com/wangfupeng1988/p/3994065.html" target="_blank" rel="noopener noreferrer">王福朋---深入理解JS原型和闭包<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/HMC-VUEPRESS-NOTE/javascript进阶/javascript深入/JS事件循环执行机制.html" class="prev">2.JS事件循环执行机制</a></span> <span class="next"><a href="/HMC-VUEPRESS-NOTE/javascript进阶/JS设计模式/1.单例模式.html">1.单例模式</a>→
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/HMC-VUEPRESS-NOTE/assets/js/app.b95e11c9.js" defer></script><script src="/HMC-VUEPRESS-NOTE/assets/js/2.2ebf18b2.js" defer></script><script src="/HMC-VUEPRESS-NOTE/assets/js/36.3e16e88b.js" defer></script>
  </body>
</html>
